<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WAICY Originality Checker</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #f8fafc; }
    header { background: #0f172a; color: white; padding: 16px 24px; }
    main { max-width: 900px; margin: 24px auto; background: white; padding: 24px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.06); }
    h1 { margin: 0 0 6px 0; font-size: 22px; }
    .muted { color: #64748b; font-size: 14px; }
    .section { margin-top: 20px; }
    input, select, textarea { width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid #cbd5e1; }
    textarea { min-height: 120px; resize: vertical; }
    button { padding: 12px 16px; border: none; border-radius: 12px; cursor: pointer; }
    .primary { background: #2563eb; color: white; }
    .secondary { background: #e2e8f0; }
    .row { display: flex; gap: 10px; align-items: center; }
    .result { border: 1px solid #e2e8f0; border-radius: 12px; padding: 12px; margin-top: 10px; }
    .badge { background: #eef2ff; color: #3730a3; border-radius: 999px; padding: 2px 8px; font-size: 12px; }
    .space { height: 10px; }
    .footer { text-align: center; color: #94a3b8; font-size: 12px; margin-top: 16px; }
    .link { color: #2563eb; text-decoration: none; }
  </style>
</head>
<body>
  <header>
    <h1>WAICY Originality Checker</h1>
    <div class="muted">Describe your AI project idea. We’ll compare it to past entries.</div>
  </header>

  <main>
    <div class="section">
      <h3>Participant Information</h3>
      <div class="row" style="gap:12px;">
        <input id="name" placeholder="Your name">
        <select id="grade">
          <option value="">Select grade</option>
          <option>Elementary School</option>
          <option>Middle School</option>
          <option>High School</option>
        </select>
        <select id="track">
          <option value="">Select track</option>
          <option>AI Generated Art</option>
          <option>AI-Generated Video</option>
          <option>AI Large Language Models</option>
          <option>AI Showcase</option>
        </select>
      </div>
    </div>

    <div class="section">
      <h3>Your Idea</h3>
      <textarea id="idea" placeholder="Describe your idea in plain English (2–5 sentences)."></textarea>
      <div class="space"></div>
      <div class="row">
        <button class="primary" onclick="checkAndLog()">Check Originality</button>
        <button class="secondary" onclick="loadProjects()">Browse Past Projects</button>
        <a class="link" href="/admin">Admin</a>
      </div>
    </div>

    <div id="results" class="section"></div>
    <div id="projects" class="section"></div>
    <div class="footer">This tool logs anonymous results (name/grade/track/idea/verdict) for quality review.</div>
  </main>

  <script>
    async function checkAndLog() {
      const name = document.getElementById('name').value.trim();
      const grade = document.getElementById('grade').value.trim();
      const track = document.getElementById('track').value.trim();
      const idea = document.getElementById('idea').value.trim();

      if (!name || !grade || !track || !idea) {
        alert('Please fill your name, grade, track and idea first.');
        return;
      }

      const res = await fetch('/api/check_and_log', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, grade, track, idea })
      });
      const data = await res.json();
      if (!res.ok) { alert(data.error || 'Error'); return; }

      const el = document.getElementById('results');
      el.innerHTML = '';
      const header = document.createElement('div');
      header.className = 'result';
      header.innerHTML = `<strong>Verdict:</strong> ${data.verdict}
        <span class="badge" style="float:right">${data.matches.length} similar</span>
        <div class="muted">${data.message}</div>`;
      el.appendChild(header);

      if (data.suggestions && data.suggestions.length) {
        const sug = document.createElement('div');
        sug.className = 'result';
        sug.innerHTML = '<strong>Make it more unique:</strong>';
        const ul = document.createElement('ul');
        data.suggestions.forEach(s => { const li = document.createElement('li'); li.textContent = s; ul.appendChild(li); });
        sug.appendChild(ul);
        el.appendChild(sug);
      }

      data.matches.forEach(m => {
        const d = document.createElement('div');
        d.className = 'result';
        d.innerHTML = `<div class="row" style="justify-content: space-between;">
          <div><strong>${m.project_name}</strong> <span class="badge">${m.year}</span></div>
          <div class="muted">Similarity: ${(m.score*100).toFixed(1)}%</div>
        </div>
        <div class="muted">${m.category || ''}</div>
        <div>${m.summary}</div>
        <div class="space"></div>
        ${m.link ? `<a class="link" href="${m.link}" target="_blank">Project link</a>` : ''}`;
        el.appendChild(d);
      });
    }

    async function loadProjects() {
      const res = await fetch('/api/projects');
      const data = await res.json();
      const el = document.getElementById('projects');
      el.innerHTML = '<h3>Projects</h3>';
      (data.projects || []).forEach(p => {
        const d = document.createElement('div'); d.className='result';
        d.innerHTML = `<strong>${p.project_name}</strong> <span class="badge">${p.year}</span> – ${p.category || ''}<br>${p.summary}`;
        el.appendChild(d);
      });
    }
  </script>
</body>
</html>
